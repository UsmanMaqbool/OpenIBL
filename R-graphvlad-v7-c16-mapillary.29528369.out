Sat Apr 20 13:50:07 EDT 2024
/home/m.maqboolbhutta/usman_ws/codes/OpenIBL
/home/m.maqboolbhutta/.conda/envs/openibl/bin/python
Host: c1001a-s29
Other nodes: 
/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr
==========Starting Training=============
========================================
Use GPU: 3 for training, rank no.3 of world_size 4
Use GPU: 0 for training, rank no.0 of world_size 4
Use GPU: 1 for training, rank no.1 of world_size 4
Use GPU: 2 for training, rank no.2 of world_size 4
==========
Args:Namespace(arch='vgg16', cache_size=1000, data_dir='/home/m.maqboolbhutta/usman_ws/codes/OpenIBL/examples/data/', dataset='pitts', deterministic=False, epochs=5, esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', eval_step=1, features=4096, gpu=0, height=480, init_dir='/blue/hmedeiros/m.maqboolbhutta/datasets/openibl-init', iters=0, launcher='slurm', layers='conv5', logs_dir='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr', loss_type='sare_ind', lr=0.01, margin=0.1, method='graphvlad', momentum=0.9, neg_num=10, neg_pool=1000, ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=200, rank=0, rerank=False, resume='', scale='30k', seed=43, step_size=5, sync_gather=True, syncbn=True, tcp_port='6010', test_batch_size=32, total_gpus=4, tuple_size=4, vlad=True, weight_decay=0.001, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
No. of Clusters:  16
No. of Clusters:  16
No. of Clusters:  16
No. of Clusters:  16
Loading centroids from /blue/hmedeiros/m.maqboolbhutta/datasets/openibl-init/centroids/vgg16_mapillary_16_desc_cen.hdf5
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
Test the initial model:
Extract Features: [100/138]	Time 0.711 (0.842)	Data 0.000 (0.111)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          46.1%
  top-5          68.6%
  top-10         76.8%
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.722 (0.810)	Data 0.000 (0.106)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.696 (0.805)	Data 0.000 (0.102)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.700 (0.809)	Data 0.000 (0.108)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.695 (0.807)	Data 0.000 (0.110)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.711 (0.814)	Data 0.000 (0.105)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.712 (0.811)	Data 0.000 (0.108)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.701 (0.811)	Data 0.000 (0.113)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.716 (0.808)	Data 0.000 (0.106)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.693 (0.800)	Data 0.000 (0.105)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          78.3%
  top-5          90.5%
  top-10         93.7%

 * Finished epoch   0 recall@1: 78.3%  recall@5: 90.5%  recall@10: 93.7%  best@5: 90.5% *

===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.709 (0.816)	Data 0.000 (0.113)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.745 (0.813)	Data 0.000 (0.109)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.692 (0.805)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.693 (0.810)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.732 (0.812)	Data 0.000 (0.111)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.723 (0.815)	Data 0.000 (0.108)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.696 (0.809)	Data 0.000 (0.108)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.705 (0.806)	Data 0.000 (0.106)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.699 (0.808)	Data 0.000 (0.104)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          81.1%
  top-5          92.0%
  top-10         94.9%

 * Finished epoch   1 recall@1: 81.1%  recall@5: 92.0%  recall@10: 94.9%  best@5: 92.0% *

===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.692 (0.807)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.763 (0.808)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.697 (0.819)	Data 0.000 (0.108)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.692 (0.806)	Data 0.000 (0.110)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.703 (0.808)	Data 0.000 (0.109)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.736 (0.810)	Data 0.000 (0.104)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.713 (0.813)	Data 0.000 (0.111)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.689 (0.809)	Data 0.000 (0.105)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.697 (0.801)	Data 0.000 (0.102)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          82.8%
  top-5          92.9%
  top-10         95.6%

 * Finished epoch   2 recall@1: 82.8%  recall@5: 92.9%  recall@10: 95.6%  best@5: 92.9% *

===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.720 (0.815)	Data 0.000 (0.111)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.714 (0.812)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.716 (0.810)	Data 0.000 (0.105)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.696 (0.814)	Data 0.000 (0.106)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.713 (0.822)	Data 0.000 (0.112)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.703 (0.816)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.696 (0.814)	Data 0.000 (0.111)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.708 (0.808)	Data 0.000 (0.105)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.720 (0.812)	Data 0.000 (0.103)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          82.0%
  top-5          92.5%
  top-10         94.9%

 * Finished epoch   3 recall@1: 82.0%  recall@5: 92.5%  recall@10: 94.9%  best@5: 92.9%

===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.726 (0.805)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.689 (0.813)	Data 0.000 (0.109)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.764 (0.823)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.697 (0.812)	Data 0.000 (0.106)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.742 (0.812)	Data 0.000 (0.108)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.721 (0.811)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.724 (0.818)	Data 0.000 (0.108)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.697 (0.816)	Data 0.000 (0.111)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.706 (0.811)	Data 0.000 (0.104)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          81.7%
  top-5          92.9%
  top-10         95.3%

 * Finished epoch   4 recall@1: 81.7%  recall@5: 92.9%  recall@10: 95.3%  best@5: 92.9% *

Performing PCA reduction on the best model:
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/model_best.pth.tar'
Extract Features: [100/136]	Time 0.705 (0.804)	Data 0.000 (0.109)	
calculating PCA parameters...
================= PCA RESULT ==================
U: (8192, 4096)
lams: (4096,)
mu: (8192, 1)
Utmu: (4096, 1)
===============================================
Testing on Pitts30k-test:
load PCA parameters...
Extract Features: [100/132]	Time 0.687 (0.840)	Data 0.000 (0.134)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          86.9%
  top-5          93.4%
  top-10         95.0%
==========Testing=============
/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint0.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint1.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint2.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint3.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint4.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/model_best.pth.tar
==============================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint0.pth.tar file...
=======================================
Use GPU: 1 for testing, rank no.1 of world_size 4Use GPU: 2 for testing, rank no.2 of world_size 4
Use GPU: 3 for testing, rank no.3 of world_size 4
Use GPU: 0 for testing, rank no.0 of world_size 4

==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint0.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint0.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint0.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint0.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint0.h5
missing keys in state_dict: {'module.net_vlad.centroids', 'module.net_vlad.conv.weight'}
=> Start epoch 0  best recall5 90.5%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint0.h5
Extract Features: [100/136]	Time 0.712 (0.876)	Data 0.000 (0.094)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
calculating PCA parameters...
================= PCA RESULT ==================
U: (32768, 4096)
lams: (4096,)
mu: (32768, 1)
Utmu: (4096, 1)
===============================================
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          77.4%
  top-5          88.0%
  top-10         90.8%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.755 (0.872)	Data 0.000 (0.116)	
Extract Features: [200/594]	Time 0.740 (0.807)	Data 0.000 (0.058)	
Extract Features: [300/594]	Time 0.737 (0.783)	Data 0.000 (0.039)	
Extract Features: [400/594]	Time 0.733 (0.771)	Data 0.000 (0.029)	
Extract Features: [500/594]	Time 0.739 (0.764)	Data 0.000 (0.023)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          54.3%
  top-5          68.9%
  top-10         74.6%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint0.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint1.pth.tar file...
=======================================
Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 2 for testing, rank no.2 of world_size 4Use GPU: 0 for testing, rank no.0 of world_size 4Use GPU: 1 for testing, rank no.1 of world_size 4



==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint1.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint1.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
PCA parameters path: missing keys in state_dict:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint1.h5{'module.net_vlad.conv.weight', 'module.net_vlad.centroids'}

=> Start epoch 1  best recall5 92.0%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint1.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint1.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint1.h5
Extract Features: [100/136]	Time 0.715 (0.877)	Data 0.000 (0.093)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
calculating PCA parameters...
================= PCA RESULT ==================
U: (32768, 4096)
lams: (4096,)
mu: (32768, 1)
Utmu: (4096, 1)
===============================================
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          77.7%
  top-5          88.3%
  top-10         90.9%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.726 (0.827)	Data 0.000 (0.108)	
Extract Features: [200/594]	Time 0.716 (0.774)	Data 0.000 (0.054)	
Extract Features: [300/594]	Time 0.719 (0.758)	Data 0.000 (0.036)	
Extract Features: [400/594]	Time 0.715 (0.749)	Data 0.000 (0.027)	
Extract Features: [500/594]	Time 0.752 (0.743)	Data 0.000 (0.022)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          54.6%
  top-5          69.8%
  top-10         77.1%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint1.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint2.pth.tar file...
=======================================
Use GPU: 2 for testing, rank no.2 of world_size 4Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 0 for testing, rank no.0 of world_size 4Use GPU: 1 for testing, rank no.1 of world_size 4



==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint2.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint2.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint2.h5
missing keys in state_dict: {'module.net_vlad.conv.weight', 'module.net_vlad.centroids'}
=> Start epoch 2  best recall5 92.9%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint2.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint2.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint2.h5
Extract Features: [100/136]	Time 0.722 (0.888)	Data 0.000 (0.097)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
calculating PCA parameters...
================= PCA RESULT ==================
U: (32768, 4096)
lams: (4096,)
mu: (32768, 1)
Utmu: (4096, 1)
===============================================
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          78.0%
  top-5          88.5%
  top-10         91.5%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.713 (0.836)	Data 0.000 (0.111)	
Extract Features: [200/594]	Time 0.714 (0.772)	Data 0.000 (0.056)	
Extract Features: [300/594]	Time 0.706 (0.749)	Data 0.000 (0.037)	
Extract Features: [400/594]	Time 0.697 (0.739)	Data 0.000 (0.029)	
Extract Features: [500/594]	Time 0.703 (0.732)	Data 0.000 (0.023)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          55.9%
  top-5          71.4%
  top-10         75.6%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint2.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint3.pth.tar file...
=======================================
Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 2 for testing, rank no.2 of world_size 4Use GPU: 0 for testing, rank no.0 of world_size 4Use GPU: 1 for testing, rank no.1 of world_size 4



==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint3.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint3.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint3.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint3.h5
missing keys in state_dict: {'module.net_vlad.centroids', 'module.net_vlad.conv.weight'}
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint3.h5
=> Start epoch 3  best recall5 92.9%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint3.h5
Extract Features: [100/136]	Time 0.790 (0.907)	Data 0.000 (0.094)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
calculating PCA parameters...
================= PCA RESULT ==================
U: (32768, 4096)
lams: (4096,)
mu: (32768, 1)
Utmu: (4096, 1)
===============================================
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          78.4%
  top-5          88.7%
  top-10         91.5%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.718 (0.829)	Data 0.000 (0.110)	
Extract Features: [200/594]	Time 0.730 (0.771)	Data 0.000 (0.055)	
Extract Features: [300/594]	Time 0.717 (0.753)	Data 0.000 (0.037)	
Extract Features: [400/594]	Time 0.710 (0.745)	Data 0.000 (0.028)	
Extract Features: [500/594]	Time 0.706 (0.739)	Data 0.000 (0.022)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          56.2%
  top-5          74.3%
  top-10         78.1%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint3.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint4.pth.tar file...
=======================================
Use GPU: 2 for testing, rank no.2 of world_size 4Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 0 for testing, rank no.0 of world_size 4Use GPU: 1 for testing, rank no.1 of world_size 4



==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint4.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint4.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
missing keys in state_dict: {'module.net_vlad.centroids', 'module.net_vlad.conv.weight'}
=> Start epoch 4  best recall5 92.9%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint4.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint4.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint4.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_checkpoint4.h5
Extract Features: [100/136]	Time 0.732 (0.904)	Data 0.000 (0.092)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
calculating PCA parameters...
================= PCA RESULT ==================
U: (32768, 4096)
lams: (4096,)
mu: (32768, 1)
Utmu: (4096, 1)
===============================================
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          78.7%
  top-5          88.9%
  top-10         91.4%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.718 (0.820)	Data 0.000 (0.103)	
Extract Features: [200/594]	Time 0.713 (0.767)	Data 0.000 (0.052)	
Extract Features: [300/594]	Time 0.707 (0.749)	Data 0.000 (0.035)	
Extract Features: [400/594]	Time 0.715 (0.740)	Data 0.000 (0.026)	
Extract Features: [500/594]	Time 0.718 (0.734)	Data 0.000 (0.021)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          59.4%
  top-5          74.9%
  top-10         80.6%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/checkpoint4.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/model_best.pth.tar file...
=======================================
Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 2 for testing, rank no.2 of world_size 4Use GPU: 0 for testing, rank no.0 of world_size 4Use GPU: 1 for testing, rank no.1 of world_size 4



==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/model_best.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/model_best.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_model_best.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_model_best.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_model_best.h5missing keys in state_dict:
 {'module.net_vlad.centroids', 'module.net_vlad.conv.weight'}
=> Start epoch 4  best recall5 92.9%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/pca_params_model_best.h5
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_ind-lr0.01-20-Apr/model_best.pth.tar file...
=======================================
/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr
==========Starting Training=============
========================================
Use GPU: 0 for training, rank no.0 of world_size 4
Use GPU: 2 for training, rank no.2 of world_size 4
Use GPU: 3 for training, rank no.3 of world_size 4
Use GPU: 1 for training, rank no.1 of world_size 4
==========
Args:Namespace(arch='vgg16', cache_size=1000, data_dir='/home/m.maqboolbhutta/usman_ws/codes/OpenIBL/examples/data/', dataset='pitts', deterministic=False, epochs=5, esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', eval_step=1, features=4096, gpu=0, height=480, init_dir='/blue/hmedeiros/m.maqboolbhutta/datasets/openibl-init', iters=0, launcher='slurm', layers='conv5', logs_dir='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr', loss_type='sare_joint', lr=0.01, margin=0.1, method='graphvlad', momentum=0.9, neg_num=10, neg_pool=1000, ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=200, rank=0, rerank=False, resume='', scale='30k', seed=43, step_size=5, sync_gather=True, syncbn=True, tcp_port='6010', test_batch_size=32, total_gpus=4, tuple_size=4, vlad=True, weight_decay=0.001, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
No. of Clusters:  16
No. of Clusters:  16
No. of Clusters:  16
Loading centroids from /blue/hmedeiros/m.maqboolbhutta/datasets/openibl-init/centroids/vgg16_mapillary_16_desc_cen.hdf5
No. of Clusters:  16
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
Test the initial model:
Extract Features: [100/138]	Time 0.699 (0.829)	Data 0.000 (0.109)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          46.1%
  top-5          68.6%
  top-10         76.8%
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.692 (0.831)	Data 0.000 (0.123)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.703 (0.838)	Data 0.000 (0.125)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.716 (0.834)	Data 0.000 (0.123)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.711 (0.842)	Data 0.000 (0.124)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.716 (0.836)	Data 0.000 (0.125)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.735 (0.837)	Data 0.000 (0.124)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.711 (0.827)	Data 0.000 (0.120)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.737 (0.845)	Data 0.000 (0.135)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.715 (0.841)	Data 0.000 (0.124)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          74.7%
  top-5          88.4%
  top-10         92.5%

 * Finished epoch   0 recall@1: 74.7%  recall@5: 88.4%  recall@10: 92.5%  best@5: 88.4% *

===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.742 (0.838)	Data 0.000 (0.129)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.731 (0.838)	Data 0.000 (0.125)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.722 (0.833)	Data 0.000 (0.127)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.726 (0.839)	Data 0.000 (0.131)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.708 (0.839)	Data 0.000 (0.124)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.724 (0.850)	Data 0.000 (0.126)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.743 (0.849)	Data 0.000 (0.133)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.720 (0.840)	Data 0.006 (0.131)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.765 (0.820)	Data 0.000 (0.105)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          74.6%
  top-5          88.6%
  top-10         92.8%

 * Finished epoch   1 recall@1: 74.6%  recall@5: 88.6%  recall@10: 92.8%  best@5: 88.6% *

===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.716 (0.832)	Data 0.000 (0.122)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.730 (0.838)	Data 0.000 (0.124)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.708 (0.853)	Data 0.000 (0.133)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.715 (0.834)	Data 0.000 (0.120)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.734 (0.842)	Data 0.000 (0.127)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.720 (0.837)	Data 0.000 (0.129)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.739 (0.841)	Data 0.000 (0.128)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.705 (0.833)	Data 0.000 (0.122)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.741 (0.827)	Data 0.000 (0.115)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          75.3%
  top-5          88.4%
  top-10         92.1%

 * Finished epoch   2 recall@1: 75.3%  recall@5: 88.4%  recall@10: 92.1%  best@5: 88.6%

===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.722 (0.839)	Data 0.000 (0.123)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.757 (0.833)	Data 0.000 (0.122)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.713 (0.826)	Data 0.000 (0.121)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.762 (0.833)	Data 0.000 (0.121)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.706 (0.832)	Data 0.000 (0.124)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.714 (0.833)	Data 0.000 (0.123)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.729 (0.844)	Data 0.000 (0.126)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.710 (0.842)	Data 0.000 (0.129)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.733 (0.824)	Data 0.000 (0.108)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          76.0%
  top-5          89.5%
  top-10         93.2%

 * Finished epoch   3 recall@1: 76.0%  recall@5: 89.5%  recall@10: 93.2%  best@5: 89.5% *

===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.735 (0.833)	Data 0.000 (0.121)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.707 (0.837)	Data 0.000 (0.124)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.706 (0.828)	Data 0.000 (0.118)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.707 (0.837)	Data 0.000 (0.124)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.716 (0.836)	Data 0.000 (0.126)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.706 (0.836)	Data 0.000 (0.124)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.723 (0.838)	Data 0.000 (0.123)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.719 (0.838)	Data 0.000 (0.127)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.706 (0.818)	Data 0.000 (0.112)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          74.2%
  top-5          88.4%
  top-10         92.2%

 * Finished epoch   4 recall@1: 74.2%  recall@5: 88.4%  recall@10: 92.2%  best@5: 89.5%

Performing PCA reduction on the best model:
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/model_best.pth.tar'
Extract Features: [100/136]	Time 0.714 (0.837)	Data 0.000 (0.127)	
calculating PCA parameters...
================= PCA RESULT ==================
U: (8192, 4096)
lams: (4096,)
mu: (8192, 1)
Utmu: (4096, 1)
===============================================
Testing on Pitts30k-test:
load PCA parameters...
Extract Features: [100/132]	Time 0.722 (0.834)	Data 0.000 (0.127)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          85.6%
  top-5          93.0%
  top-10         94.8%
==========Testing=============
/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint0.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint1.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint2.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint3.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint4.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/model_best.pth.tar
==============================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint0.pth.tar file...
=======================================
Use GPU: 0 for testing, rank no.0 of world_size 4Use GPU: 2 for testing, rank no.2 of world_size 4
Use GPU: 3 for testing, rank no.3 of world_size 4
Use GPU: 1 for testing, rank no.1 of world_size 4

==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint0.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint0.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
missing keys in state_dict: {'module.net_vlad.conv.weight', 'module.net_vlad.centroids'}
=> Start epoch 0  best recall5 88.4%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint0.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint0.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint0.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint0.h5
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          41.0%
  top-5          67.3%
  top-10         77.3%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.714 (0.855)	Data 0.000 (0.142)	
Extract Features: [200/594]	Time 0.712 (0.823)	Data 0.000 (0.115)	
Extract Features: [300/594]	Time 0.698 (0.798)	Data 0.000 (0.092)	
Extract Features: [400/594]	Time 0.703 (0.774)	Data 0.000 (0.069)	
Extract Features: [500/594]	Time 0.695 (0.760)	Data 0.000 (0.055)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1           8.3%
  top-5          20.6%
  top-10         28.9%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint0.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint1.pth.tar file...
=======================================
Use GPU: 2 for testing, rank no.2 of world_size 4Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 1 for testing, rank no.1 of world_size 4Use GPU: 0 for testing, rank no.0 of world_size 4



==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint1.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint1.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint1.h5
missing keys in state_dict: {'module.net_vlad.centroids', 'module.net_vlad.conv.weight'}
=> Start epoch 1  best recall5 88.6%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint1.h5
Evaluate on the test set:
==========Test on Pitts30k=============
PCA parameters path: PCA parameters path:   /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint1.h5/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint1.h5

load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          45.9%
  top-5          71.4%
  top-10         81.2%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.749 (0.842)	Data 0.000 (0.102)	
Extract Features: [200/594]	Time 0.738 (0.793)	Data 0.000 (0.051)	
Extract Features: [300/594]	Time 0.736 (0.776)	Data 0.000 (0.034)	
Extract Features: [400/594]	Time 0.745 (0.770)	Data 0.000 (0.026)	
Extract Features: [500/594]	Time 0.786 (0.767)	Data 0.000 (0.021)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          10.8%
  top-5          25.7%
  top-10         37.8%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint1.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint2.pth.tar file...
=======================================
Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 0 for testing, rank no.0 of world_size 4Use GPU: 2 for testing, rank no.2 of world_size 4Use GPU: 1 for testing, rank no.1 of world_size 4



==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint2.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint2.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint2.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint2.h5
missing keys in state_dict: {'module.net_vlad.conv.weight', 'module.net_vlad.centroids'}
=> Start epoch 2  best recall5 88.6%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint2.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint2.h5
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          47.0%
  top-5          72.3%
  top-10         82.2%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.751 (0.843)	Data 0.000 (0.114)	
Extract Features: [200/594]	Time 0.753 (0.787)	Data 0.000 (0.057)	
Extract Features: [300/594]	Time 0.723 (0.768)	Data 0.000 (0.038)	
Extract Features: [400/594]	Time 0.771 (0.760)	Data 0.000 (0.029)	
Extract Features: [500/594]	Time 0.718 (0.755)	Data 0.000 (0.023)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          11.7%
  top-5          27.0%
  top-10         38.1%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint2.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint3.pth.tar file...
=======================================
Use GPU: 1 for testing, rank no.1 of world_size 4Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 2 for testing, rank no.2 of world_size 4
Use GPU: 0 for testing, rank no.0 of world_size 4


==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint3.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint3.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint3.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint3.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint3.h5
missing keys in state_dict: {'module.net_vlad.centroids', 'module.net_vlad.conv.weight'}
=> Start epoch 3  best recall5 89.5%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint3.h5
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          47.0%
  top-5          72.5%
  top-10         82.6%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.731 (0.834)	Data 0.000 (0.110)	
Extract Features: [200/594]	Time 0.733 (0.782)	Data 0.000 (0.055)	
Extract Features: [300/594]	Time 0.748 (0.767)	Data 0.000 (0.037)	
Extract Features: [400/594]	Time 0.733 (0.757)	Data 0.000 (0.028)	
Extract Features: [500/594]	Time 0.744 (0.754)	Data 0.000 (0.022)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          15.2%
  top-5          31.1%
  top-10         38.7%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint3.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint4.pth.tar file...
=======================================
Use GPU: 0 for testing, rank no.0 of world_size 4Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 2 for testing, rank no.2 of world_size 4Use GPU: 1 for testing, rank no.1 of world_size 4



==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint4.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint4.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint4.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint4.h5
missing keys in state_dict: {'module.net_vlad.centroids', 'module.net_vlad.conv.weight'}
=> Start epoch 4  best recall5 89.5%
PCA parameters path: PCA parameters path:   /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint4.h5/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_checkpoint4.h5

Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          47.0%
  top-5          72.6%
  top-10         81.8%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.776 (0.861)	Data 0.000 (0.130)	
Extract Features: [200/594]	Time 0.738 (0.796)	Data 0.000 (0.065)	
Extract Features: [300/594]	Time 0.737 (0.777)	Data 0.000 (0.043)	
Extract Features: [400/594]	Time 0.736 (0.769)	Data 0.000 (0.033)	
Extract Features: [500/594]	Time 0.739 (0.762)	Data 0.000 (0.026)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1           9.2%
  top-5          24.8%
  top-10         32.1%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/checkpoint4.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/model_best.pth.tar file...
=======================================
Use GPU: 2 for testing, rank no.2 of world_size 4Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 1 for testing, rank no.1 of world_size 4Use GPU: 0 for testing, rank no.0 of world_size 4



==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/model_best.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/model_best.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
missing keys in state_dict: {'module.net_vlad.conv.weight', 'module.net_vlad.centroids'}
=> Start epoch 3  best recall5 89.5%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_model_best.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_model_best.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_model_best.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/pca_params_model_best.h5
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-sare_joint-lr0.01-20-Apr/model_best.pth.tar file...
=======================================
/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr
==========Starting Training=============
========================================
Use GPU: 2 for training, rank no.2 of world_size 4
Use GPU: 0 for training, rank no.0 of world_size 4
Use GPU: 3 for training, rank no.3 of world_size 4
Use GPU: 1 for training, rank no.1 of world_size 4
==========
Args:Namespace(arch='vgg16', cache_size=1000, data_dir='/home/m.maqboolbhutta/usman_ws/codes/OpenIBL/examples/data/', dataset='pitts', deterministic=False, epochs=5, esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', eval_step=1, features=4096, gpu=0, height=480, init_dir='/blue/hmedeiros/m.maqboolbhutta/datasets/openibl-init', iters=0, launcher='slurm', layers='conv5', logs_dir='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr', loss_type='triplet', lr=0.01, margin=0.1, method='graphvlad', momentum=0.9, neg_num=10, neg_pool=1000, ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=200, rank=0, rerank=False, resume='', scale='30k', seed=43, step_size=5, sync_gather=True, syncbn=True, tcp_port='6010', test_batch_size=32, total_gpus=4, tuple_size=4, vlad=True, weight_decay=0.001, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
No. of Clusters:  16
No. of Clusters:  16
No. of Clusters:  16
Loading centroids from /blue/hmedeiros/m.maqboolbhutta/datasets/openibl-init/centroids/vgg16_mapillary_16_desc_cen.hdf5
No. of Clusters:  16
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
Test the initial model:
Extract Features: [100/138]	Time 0.672 (0.818)	Data 0.000 (0.116)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          46.1%
  top-5          68.6%
  top-10         76.8%
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.671 (0.811)	Data 0.000 (0.124)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.715 (0.819)	Data 0.000 (0.127)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.710 (0.812)	Data 0.000 (0.125)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.712 (0.845)	Data 0.000 (0.146)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.699 (0.823)	Data 0.000 (0.126)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.704 (0.818)	Data 0.000 (0.121)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.708 (0.814)	Data 0.000 (0.123)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.704 (0.812)	Data 0.000 (0.123)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.702 (0.819)	Data 0.000 (0.124)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          84.1%
  top-5          93.2%
  top-10         95.8%

 * Finished epoch   0 recall@1: 84.1%  recall@5: 93.2%  recall@10: 95.8%  best@5: 93.2% *

===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.696 (0.810)	Data 0.000 (0.123)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.677 (0.812)	Data 0.000 (0.127)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.714 (0.800)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.725 (0.822)	Data 0.000 (0.111)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.714 (0.819)	Data 0.000 (0.114)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.697 (0.803)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.691 (0.804)	Data 0.000 (0.110)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.684 (0.808)	Data 0.000 (0.110)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.703 (0.793)	Data 0.000 (0.102)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          84.5%
  top-5          93.4%
  top-10         95.6%

 * Finished epoch   1 recall@1: 84.5%  recall@5: 93.4%  recall@10: 95.6%  best@5: 93.4% *

===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.689 (0.794)	Data 0.000 (0.109)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.679 (0.800)	Data 0.000 (0.104)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.708 (0.799)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.711 (0.799)	Data 0.000 (0.108)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.719 (0.799)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.685 (0.802)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.691 (0.795)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.690 (0.792)	Data 0.000 (0.108)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.687 (0.793)	Data 0.000 (0.100)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          84.3%
  top-5          93.5%
  top-10         96.0%

 * Finished epoch   2 recall@1: 84.3%  recall@5: 93.5%  recall@10: 96.0%  best@5: 93.5% *

===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.677 (0.800)	Data 0.000 (0.106)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.699 (0.801)	Data 0.000 (0.105)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.677 (0.798)	Data 0.000 (0.108)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.774 (0.799)	Data 0.013 (0.104)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.679 (0.809)	Data 0.000 (0.104)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.746 (0.798)	Data 0.000 (0.103)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.706 (0.797)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.678 (0.802)	Data 0.000 (0.110)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.701 (0.790)	Data 0.000 (0.101)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          85.1%
  top-5          94.0%
  top-10         96.4%

 * Finished epoch   3 recall@1: 85.1%  recall@5: 94.0%  recall@10: 96.4%  best@5: 94.0% *

===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.705 (0.798)	Data 0.000 (0.112)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.677 (0.815)	Data 0.000 (0.111)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.709 (0.809)	Data 0.000 (0.111)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.683 (0.799)	Data 0.000 (0.110)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.691 (0.802)	Data 0.000 (0.107)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.730 (0.801)	Data 0.000 (0.110)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.682 (0.808)	Data 0.000 (0.109)	
===> Start calculating pairwise distances
===> Start sorting gallery
===> Start extracting features for sorting gallery
Extract Features: [100/136]	Time 0.697 (0.796)	Data 0.000 (0.108)	
===> Start calculating pairwise distances
===> Start sorting gallery
Extract Features: [100/138]	Time 0.698 (0.791)	Data 0.000 (0.103)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          85.7%
  top-5          94.5%
  top-10         96.6%

 * Finished epoch   4 recall@1: 85.7%  recall@5: 94.5%  recall@10: 96.6%  best@5: 94.5% *

Performing PCA reduction on the best model:
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/model_best.pth.tar'
Extract Features: [100/136]	Time 0.733 (0.815)	Data 0.000 (0.112)	
calculating PCA parameters...
================= PCA RESULT ==================
U: (8192, 4096)
lams: (4096,)
mu: (8192, 1)
Utmu: (4096, 1)
===============================================
Testing on Pitts30k-test:
load PCA parameters...
Extract Features: [100/132]	Time 0.698 (0.843)	Data 0.000 (0.144)	
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          87.2%
  top-5          93.5%
  top-10         95.1%
==========Testing=============
/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint0.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint1.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint2.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint3.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint4.pth.tar /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/model_best.pth.tar
==============================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint0.pth.tar file...
=======================================
Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 2 for testing, rank no.2 of world_size 4
Use GPU: 0 for testing, rank no.0 of world_size 4
Use GPU: 1 for testing, rank no.1 of world_size 4

==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint0.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint0.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
missing keys in state_dict: {'module.net_vlad.centroids', 'module.net_vlad.conv.weight'}
=> Start epoch 0  best recall5 93.2%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint0.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint0.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint0.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint0.h5
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          61.0%
  top-5          78.7%
  top-10         84.4%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.748 (0.868)	Data 0.000 (0.140)	
Extract Features: [200/594]	Time 0.746 (0.842)	Data 0.000 (0.110)	
Extract Features: [300/594]	Time 0.749 (0.808)	Data 0.000 (0.075)	
Extract Features: [400/594]	Time 0.762 (0.795)	Data 0.000 (0.058)	
Extract Features: [500/594]	Time 0.732 (0.786)	Data 0.000 (0.047)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          23.5%
  top-5          41.0%
  top-10         49.8%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint0.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint1.pth.tar file...
=======================================
Use GPU: 2 for testing, rank no.2 of world_size 4Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 0 for testing, rank no.0 of world_size 4Use GPU: 1 for testing, rank no.1 of world_size 4



==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint1.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint1.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint1.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint1.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint1.h5
missing keys in state_dict: {'module.net_vlad.conv.weight', 'module.net_vlad.centroids'}
=> Start epoch 1  best recall5 93.4%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint1.h5
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          61.5%
  top-5          79.4%
  top-10         84.9%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.730 (0.844)	Data 0.000 (0.113)	
Extract Features: [200/594]	Time 0.735 (0.789)	Data 0.000 (0.056)	
Extract Features: [300/594]	Time 0.735 (0.770)	Data 0.000 (0.038)	
Extract Features: [400/594]	Time 0.721 (0.760)	Data 0.000 (0.028)	
Extract Features: [500/594]	Time 0.723 (0.754)	Data 0.000 (0.023)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          25.1%
  top-5          41.3%
  top-10         51.1%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint1.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint2.pth.tar file...
=======================================
Use GPU: 2 for testing, rank no.2 of world_size 4Use GPU: 0 for testing, rank no.0 of world_size 4Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 1 for testing, rank no.1 of world_size 4



==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint2.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint2.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
missing keys in state_dict: {'module.net_vlad.centroids', 'module.net_vlad.conv.weight'}
=> Start epoch 2  best recall5 93.5%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint2.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint2.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint2.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint2.h5
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          63.3%
  top-5          80.1%
  top-10         85.5%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.746 (0.844)	Data 0.000 (0.113)	
Extract Features: [200/594]	Time 0.775 (0.794)	Data 0.000 (0.056)	
Extract Features: [300/594]	Time 0.729 (0.775)	Data 0.000 (0.038)	
Extract Features: [400/594]	Time 0.731 (0.767)	Data 0.000 (0.028)	
Extract Features: [500/594]	Time 0.714 (0.758)	Data 0.000 (0.023)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          26.7%
  top-5          41.9%
  top-10         52.1%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint2.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint3.pth.tar file...
=======================================
Use GPU: 2 for testing, rank no.2 of world_size 4Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 1 for testing, rank no.1 of world_size 4Use GPU: 0 for testing, rank no.0 of world_size 4



==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint3.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint3.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint3.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint3.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint3.h5
missing keys in state_dict: {'module.net_vlad.conv.weight', 'module.net_vlad.centroids'}
=> Start epoch 3  best recall5 94.0%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint3.h5
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          65.2%
  top-5          81.8%
  top-10         86.8%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.726 (0.832)	Data 0.001 (0.107)	
Extract Features: [200/594]	Time 0.726 (0.779)	Data 0.000 (0.054)	
Extract Features: [300/594]	Time 0.737 (0.761)	Data 0.000 (0.036)	
Extract Features: [400/594]	Time 0.727 (0.751)	Data 0.000 (0.027)	
Extract Features: [500/594]	Time 0.740 (0.746)	Data 0.000 (0.022)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          26.3%
  top-5          44.8%
  top-10         54.3%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint3.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint4.pth.tar file...
=======================================
Use GPU: 1 for testing, rank no.1 of world_size 4Use GPU: 2 for testing, rank no.2 of world_size 4Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 0 for testing, rank no.0 of world_size 4



==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint4.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint4.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint4.h5
missing keys in state_dict: {'module.net_vlad.centroids', 'module.net_vlad.conv.weight'}
=> Start epoch 4  best recall5 94.5%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint4.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint4.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_checkpoint4.h5
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          64.5%
  top-5          81.8%
  top-10         86.6%
==========Test on Tokyo247=============
Tokyo dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |  4035  |    48420
  train_gallery |  4092  |    49104
  val_query     |  1308  |    15696
  val_gallery   |  2780  |    33360
  test_query    |    35  |      315
  test_gallery  |  6254  |    75984
load PCA parameters...
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
load PCA parameters...
Extract Features: [100/594]	Time 0.759 (0.856)	Data 0.000 (0.122)	
Extract Features: [200/594]	Time 0.730 (0.796)	Data 0.000 (0.061)	
Extract Features: [300/594]	Time 0.722 (0.773)	Data 0.000 (0.041)	
Extract Features: [400/594]	Time 0.735 (0.760)	Data 0.000 (0.031)	
Extract Features: [500/594]	Time 0.716 (0.753)	Data 0.000 (0.025)	
gathering features from rank no.0
gathering features from rank no.1
gathering features from rank no.2
gathering features from rank no.3
===> Start calculating pairwise distances
===> Start calculating recalls
Recall Scores:
  top-1          26.7%
  top-5          47.9%
  top-10         56.2%
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/checkpoint4.pth.tar file...
=======================================
==========################=============
 Testing /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/model_best.pth.tar file...
=======================================
Use GPU: 1 for testing, rank no.1 of world_size 4Use GPU: 3 for testing, rank no.3 of world_size 4Use GPU: 2 for testing, rank no.2 of world_size 4Use GPU: 0 for testing, rank no.0 of world_size 4



==========
Args:Namespace(arch='vgg16', data_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/data', dataset='pitts', esp_encoder='/home/m.maqboolbhutta/usman_ws/datasets/netvlad-official/espnet-encoder/espnet_p_2_q_8.pth', features=4096, gpu=0, height=480, lambda_value=0, launcher='pytorch', logs_dir='/blue/hmedeiros/m.maqboolbhutta/codes/OpenIBL/examples/logs', method='graphvlad', ngpus_per_node=4, nowhiten=False, num_clusters=16, print_freq=10, rank=0, reduction=True, rerank=False, resume='/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/model_best.pth.tar', rr_topk=25, scale='30k', sync_gather=False, tcp_port='5017', test_batch_size=32, vlad=True, width=640, workers=4, world_size=4)
==========
Pittsburgh dataset loaded
  subset        | # pids | # images
  ---------------------------------
  train_query   |   311  |     7320
  train_gallery |   417  |    10000
  val_query     |   319  |     7608
  val_gallery   |   417  |    10000
  test_query    |   286  |     6816
  test_gallery  |   417  |    10000
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
===> Loading segmentation model
Encoder loaded!
Encoder loaded!
Encoder loaded!
Encoder loaded!
=> Loaded checkpoint '/home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/model_best.pth.tar'
mismatch: module.net_vlad.centroids torch.Size([16, 512]) torch.Size([64, 512])
mismatch: module.net_vlad.conv.weight torch.Size([16, 512, 1, 1]) torch.Size([64, 512, 1, 1])
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_model_best.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_model_best.h5
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_model_best.h5
missing keys in state_dict: {'module.net_vlad.conv.weight', 'module.net_vlad.centroids'}
=> Start epoch 4  best recall5 94.5%
PCA parameters path:  /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/pca_params_model_best.h5
Evaluate on the test set:
==========Test on Pitts30k=============
load PCA parameters...
==========################=============
 Done Testing with /home/m.maqboolbhutta/usman_ws/models/openibl/pitts-graphvlad-triplet-lr0.01-20-Apr/model_best.pth.tar file...
=======================================
